<!-- src/app/components/task-list/task-list.component.html -->

<app-navbar></app-navbar>

<div class="container">
  <div class="header">
    <h1>Mes TÃ¢ches</h1>
    <button class="btn-add" (click)="toggleForm()" *ngIf="!showForm">
      â• Nouvelle tÃ¢che
    </button>
  </div>

  <!-- Formulaire -->
  <div class="form-card" *ngIf="showForm">
    <h3>{{ editingTask ? 'Modifier' : 'Nouvelle' }} tÃ¢che</h3>
    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label>Titre *</label>
        <input type="text" formControlName="title" placeholder="Ex: Terminer le rapport">
        <small class="error" *ngIf="taskForm.get('title')?.invalid && taskForm.get('title')?.touched">
          Minimum 3 caractÃ¨res
        </small>
      </div>

      <div class="form-group">
        <label>Description *</label>
        <textarea formControlName="description" rows="3" placeholder="DÃ©crivez votre tÃ¢che..."></textarea>
        <small class="error" *ngIf="taskForm.get('description')?.invalid && taskForm.get('description')?.touched">
          Minimum 10 caractÃ¨res
        </small>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>PrioritÃ© *</label>
          <select formControlName="priority">
            <option [value]="1">1 - TrÃ¨s basse</option>
            <option [value]="2">2 - Basse</option>
            <option [value]="3">3 - Moyenne</option>
            <option [value]="4">4 - Haute</option>
            <option [value]="5">5 - TrÃ¨s haute</option>
          </select>
        </div>

        <div class="form-group">
          <label>Date d'Ã©chÃ©ance *</label>
          <input type="date" formControlName="dueDate">
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="toggleForm()">Annuler</button>
        <button type="submit" class="btn-submit" [disabled]="taskForm.invalid">
          {{ editingTask ? 'Modifier' : 'Ajouter' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Filtres -->
  <div class="filters">
    <button [class.active]="filter === 'all'" (click)="filter = 'all'">
      Toutes ({{ (tasks$ | async)?.length || 0 }})
    </button>
    <button [class.active]="filter === 'pending'" (click)="filter = 'pending'">
      En cours ({{ (pendingTasks$ | async)?.length || 0 }})
    </button>
    <button [class.active]="filter === 'completed'" (click)="filter = 'completed'">
      TerminÃ©es ({{ (completedTasks$ | async)?.length || 0 }})
    </button>
  </div>

  <!-- Liste des tÃ¢ches -->
  <div class="tasks-grid">
    <div class="task-card"
         *ngFor="let task of getFilteredTasks() | async"
         [class.completed]="task.completed">

      <div class="task-header">
        <input type="checkbox"
               [checked]="task.completed"
               (change)="toggleComplete(task.id)"
               [id]="'task-' + task.id">
        <label [for]="'task-' + task.id"></label>
        <span class="priority" [class]="getPriorityClass(task.priority)">
          {{ getPriorityLabel(task.priority) }}
        </span>
      </div>

      <h3 [class.line-through]="task.completed">{{ task.title }}</h3>
      <p>{{ task.description }}</p>

      <div class="task-meta">
        <span>ğŸ“… {{ task.dueDate }}</span>
      </div>

      <div class="task-actions">
        <button class="btn-edit" (click)="editTask(task)" [disabled]="task.completed">
          âœï¸ Modifier
        </button>
        <button class="btn-delete" (click)="deleteTask(task.id)">
          ğŸ—‘ï¸ Supprimer
        </button>
      </div>
    </div>
  </div>

  <!-- Message vide -->
  <div class="empty" *ngIf="(getFilteredTasks() | async)?.length === 0">
    <p>ğŸ“‹ Aucune tÃ¢che</p>
  </div>
</div>
